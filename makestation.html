<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>수요조사 결과</title>
    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="./FileSaver.min.js"></script>
    <script type="text/javascript">
      $.get("./file/pre_stations.csv",function(data){
        var stations = data.split("\n");
        console.log("정류장 개수 : " + stations.length);

        var resultArray = [];

        stations.forEach(function(element) {
          var row = element.split(",");
          var passRouteArray = [];
          var passRoute = row[7].split("&");
          passRoute.forEach(function(element){
          	if(element.indexOf("*") != -1){
            	passRouteArray.push(element);
        	}
          });
          if(passRouteArray.length > 1){
	          var rowToJson = {
	            'name' : row[1],
	            'location' : {
	              '__type' : 'GeoPoint',
	              'latitude' : parseFloat(row[3]),
	              'longitude' : parseFloat(row[4])
	            },
	            'passRoute' : passRouteArray
	          }

	          resultArray.push(rowToJson);
	      }
        });

        var BOM = "\uFEFF";
        var jsonData = BOM + '{ "results": ' + JSON.stringify(resultArray) + '}';
        var blob = new Blob([jsonData], { type: "text/json;charset=utf-8" });
        saveAs(blob, "newSeedStation.json");
      }); 
    </script>
  </head>
  <body>
  </body>
</html>