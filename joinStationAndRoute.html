<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>수요조사 결과</title>
    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="http://joohyuck.github.io/FileSaver.min.js"></script>
    <script type="text/javascript">

      var stationsArray = [];
      var stationsCodeArray = [];
      var stationsNameArray = [];
      var resultContent = "";
      var redRouteArray = ['239000110','239000024','239000104','219000013','218000007','219000006','218000011','219000016','218000010','219000027','219000025','219000026','213000015','213000019','234000079','234000075','234000065','234000042','234000011','234001516','234000069','234000882','204000081','234000130','234000313','221000003','234000074','234000051','234000002','234000136','234000139','234000314','234001271','228000262','228000263','234000052','234000148','234000018','234000027','234000311','234000315','234000015','234000013','234000310','234000016','234001251','234000324','234001138','234001160','234000001','234001163','234000309','218000005','234001244','219000026','234000031','234000050','232000073','232000061','232000005','236000050','234000873','222000107','222000074','222000078','222000049','222000046','222000073','222000075','222000076','206000007','205000002','204000080','228000181','204000035','204000057','204000056','204000046','204000041','204000042','204000070','234000886','204000024','206000005','204000059','204000065','200000120','200000104','200000145','200000108','200000110','204000056','200000115','200000175','200000112','200000119','200000109','233000031','233000032','200000149','200000150','200000191','216000026','216000043','224000019','208000027','228000174','228000176','228000177','228000183','228000182','228000175','228000184','228000271','229000028','229000021','229000061','229000096','229000083','229000097','229000023','207000070','236000149','236000176','236000190','233000125','200000111','233000131','234001476','222000105','234000875','234001159','234001243','234001286','234001317','234001318','234001245','234000995','234001285','234001241','234001242','232000071','216000046','216000044','229000102','218000012','218000015','229000111','229000112','232000075','100100389','100100390','100100391','100100392','100100397','100100398','100100400','100100402','100100607','100100406','165000160','165000161','165000245','165000162','165000164'];


      //수도권 모든 정류장
      $.get("http://joohyuck.github.io/file/sudo_station.txt",function(data){
        var stations = data.split("^");
        console.log("정류장 개수 : " + stations.length);
        stations.forEach(function(element) {
          stationsCodeArray.push(element.split("|")[0]);
          stationsNameArray.push(element.split("|")[1]);
          var arr = element.split("|");
          arr[9] = "";
          stationsArray.push(arr);
        });

        //경기.인천 경유노선
        $.get("http://joohyuck.github.io/file/sudo_route_station.txt",function(data){
          var sudoLines = data.split("^");
          sudoLines.forEach(function(element, index){
            var stationOrder = stationsCodeArray.indexOf(element.split("|")[1]);
            if(stationOrder != -1){
              if(redRouteArray.indexOf(element.split("|")[0]) != -1 ) stationsArray[stationOrder][9] += "*";
              stationsArray[stationOrder][9] += element.split("|")[4]+"&";
            }
          });
          console.log("sudo_done!");
          //서울 경유노선
          $.get("http://joohyuck.github.io/file/seoul_route_station.txt",function(data){
            var seoulLines = data.split("\n");
            seoulLines.forEach(function(element, index){
              var station = element.split(",");
              var sameNameStationArray = [];
              var stationOrder = 0;
              while(true){
                stationOrder = stationsNameArray.indexOf(station[2], stationOrder+1);
                if( stationOrder == -1 ) break;
                sameNameStationArray.push(stationOrder);
              }
              //새절역.숭실고입구 -> 새절역숭실고입구로 치환해서 다시 검사
              if(station[2].indexOf(".") != -1){
                stationOrder = 0;
                var string = station[2].replace(/\./g,"");
                while(true){
                  stationOrder = stationsNameArray.indexOf(string, stationOrder+1);
                  if( stationOrder == -1 ) break;
                  sameNameStationArray.push(stationOrder);
                }
              }
              sameNameStationArray.forEach(function(el){
                var distance = Math.abs(stationsArray[el][5]-station[5]) + Math.abs(stationsArray[el][4]-station[6]);
                if(stationsArray[el][6] == "서울" && distance < 0.0005){
                  if(stationsArray[el][9].split("&").indexOf(element.split(",")[0]) == -1)
                  stationsArray[el][9] += element.split(",")[0]+"&";
                }
              });
            });
            console.log("seoul_done!");

            stationsArray.forEach(function(element){
              resultContent += element+"\n";
            });
            var BOM = "\uFEFF";
            var    csvData = BOM + resultContent;
            var blob = new Blob([csvData], { type: "text/csv;charset=utf-8" });
            saveAs(blob, "routeStation.csv");
          });
        });
      });

    </script>
  </head>
  <body>
    <progress value="0" max="0"></progress>
  </body>
</html>







































































































































































































































































































































































































































































































































































































































































































































































































































































