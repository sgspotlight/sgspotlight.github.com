<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>수요조사 결과</title>
    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="./FileSaver.min.js"></script>
    <script type="text/javascript">


      var resultArray = [];
      $.get("./file/pre_stations.csv",function(data){
        var stations = data.split("\n");
        stations.forEach(function(element) {
          var row = element.split(",");
          var arr = [];
          arr[0] = row[0];
          arr[1] = row[6];
          arr[2] = row[1];
          arr[3] = row[3];
          arr[4] = row[4];
          arr[5] = row[8];
          arr[6] = row[9];
          arr[7] = row[10];
          arr[8] = row[11];
          arr[9] = row[12];
          arr[10] = row[13].replace("\r","");
          arr[11] = [];
          row[7].split("&").forEach(function(el){
            if(el == "") return;
            var passRoute;
            if(el.indexOf("*") != -1){
              passRoute = {
                "type" : "redLine",
                "name" : el.replace("*","")
              }
            } else {
              passRoute = {
                "type" : null,
                "name" : el
              }              
            }
            arr[11].push(passRoute);
          });
          var obj = makeObject(arr);
          resultArray.push(obj);
        });

        $.get("./file/subway_geocoding_result.csv",function(subwayData){
          var subway = subwayData.split("\n");
          subway.forEach(function(element) {
            var row = element.split(",");
            var arr = [];
            arr[0] = row[6];
            arr[1] = null;
            arr[2] = row[1];
            arr[3] = row[3];
            arr[4] = row[4];
            arr[5] = row[10];
            arr[6] = row[11];
            arr[7] = row[12];
            arr[8] = row[13];
            arr[9] = row[14];
            arr[10] = "";
            if(row[15]){
              arr[10] = row[15].replace("\r","");
            }
            arr[11] = [];
            if(row[8]){
              row[8].split("&").forEach(function(el){
                var passRoute  = {
                    "type" : "subway",
                    "name" : el
                }
                arr[11].push(passRoute);
              });
            }
            var obj = makeObject(arr);
            resultArray.push(obj);
          });
          var BOM = "\uFEFF";
          var jsonData = BOM + '{ "results": ' + JSON.stringify(resultArray) + '}';
          var blob = new Blob([jsonData], { type: "text/json;charset=utf-8" });
          saveAs(blob, "Station.json");
        });
      }); 

      function makeObject(inputArray){
                var obj = {
                  "stationId" : inputArray[0],
                  "stationMobileId" : inputArray[1],
                  "stationName" :  inputArray[2],
                  "location" : {
                    '__type' : 'GeoPoint',
                    'latitude' : parseFloat(inputArray[3]),
                    'longitude' : parseFloat(inputArray[4])
                  },
                  "adressNew" : inputArray[5],
                  "adressNew" : inputArray[6],
                  "adressSido" : inputArray[7],
                  "adressSigungu" : inputArray[8],
                  "adressDongmyun" : inputArray[9],
                  "adressRest" : inputArray[10],
                  "surveyPoint" : false,
                  "people" : 0,
                  "passRoute" : inputArray[11]
                }
                return obj;
      }

    </script>
  </head>
  <body>
  </body>
</html>